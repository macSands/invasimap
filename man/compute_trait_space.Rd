% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_trait_space.R
\name{compute_trait_space}
\alias{compute_trait_space}
\title{Compute Trait Space: per-trait similarity + community dispersion}
\usage{
compute_trait_space(
  trait_df,
  species_col = 1,
  do_similarity = TRUE,
  similarity_cols = NULL,
  do_dispersion = TRUE,
  k = 4,
  pcoa_dims = 2,
  abundance = NULL,
  kde_n = 100,
  viridis_option = "D",
  show_density_plot = TRUE,
  show_plots = FALSE,
  seed = NULL
)
}
\arguments{
\item{trait_df}{data.frame. One row per species (or unit); mixed types allowed.}

\item{species_col}{integer or character (default = 1).
Column indicating the species ID; excluded from distances.}

\item{do_similarity}{logical (default = TRUE). If TRUE, compute per-trait similarity.}

\item{similarity_cols}{NULL, character, or integer. Which columns to use for similarity;
default = all columns except \code{species_col}.}

\item{do_dispersion}{logical (default = TRUE). If TRUE, run the dispersion pipeline.}

\item{k}{integer (default = 4). Number of clusters for dendrogram.}

\item{pcoa_dims}{integer (default = 2). Number of PCoA axes retained (≥ 2).}

\item{abundance}{numeric vector or NULL. Optional species weights; normalized internally.}

\item{kde_n}{integer (default = 100). KDE grid resolution for density.}

\item{viridis_option}{character (default = "D"). Palette for \code{viridisLite::viridis()}.}

\item{show_density_plot}{logical (default = TRUE). Also emit a base \code{filled.contour}.}

\item{show_plots}{logical (default = FALSE). If TRUE, prints a patchwork of ggplots.}

\item{seed}{integer or NULL. Optional RNG seed.}
}
\value{
A list with (present elements depend on flags):
\itemize{
\item \code{similarity}: data.frame with columns \code{Trait}, \code{Similarity} (0-100).
\item \code{dispersion}: list containing
\code{distance_matrix}, \code{hc}, \code{pcoa}, \code{scores}, \code{centroid},
\code{metrics_df}, and \code{plots} (ggplots: \code{$dend}, \code{$density_gg},
\code{$centrality_hist}, \code{$metrics_bar}).
}
}
\description{
A unified workflow that (1) computes within-trait similarity (numeric + categorical)
and (2) computes community-level dispersion in trait space
(Gower → clustering → PCoA → density → metrics).
}
\examples{
# Simulate a small mixed-type table
set.seed(123)
n <- 20
trait_df <- data.frame(
  species = paste0("sp_", seq_len(n)),
  height = rnorm(n),
  mass = runif(n, -1, 1),
  rank = factor(sample(1:3, n, TRUE), ordered = TRUE),
  bin = factor(sample(c(0, 1), n, TRUE)),
  cat = factor(sample(LETTERS[1:4], n, TRUE)),
  check.names = FALSE
)
abundance <- rexp(n)

out <- compute_trait_space(trait_df,
  species_col = "species", abundance = abundance,
  k = 3, pcoa_dims = 2, show_density_plot = FALSE
)
out$similarity
out$dispersion$metrics_df

}
