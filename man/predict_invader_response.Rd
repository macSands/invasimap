% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict_invader_response.R
\name{predict_invader_response}
\alias{predict_invader_response}
\title{Predict site-level responses for residents and simulated invaders}
\usage{
predict_invader_response(
  model,
  species_traits,
  site_env,
  species_col = "species",
  site_col = "site_id",
  response_type = "response",
  include_random = FALSE,
  site_aug = NULL,
  species_aug = NULL
)
}
\arguments{
\item{model}{Fitted model object (\pkg{glmmTMB}, \pkg{lme4}, \pkg{mgcv}, or base \pkg{stats}).}

\item{species_traits}{\code{data.frame}. Species traits (one row per species) containing
\code{species_col} and all trait variables referenced in the model’s fixed effects.}

\item{site_env}{\code{data.frame}. Site predictors (one row per site) containing
\code{site_col} and all environmental variables referenced in the model’s fixed effects.}

\item{species_col}{\code{character}. Species ID column in \code{species_traits}. Default \code{"species"}.}

\item{site_col}{\code{character}. Site ID column in \code{site_env}. Default \code{"site_id"}.}

\item{response_type}{\code{character}. Prediction scale for \code{predict()} where applicable
(e.g., \code{"response"} or \code{"link"}). Default \code{"response"}.}

\item{include_random}{\code{logical}. If \code{FALSE} (default), compute population-level
predictions (exclude random effects). If \code{TRUE}, compute conditional predictions
(include random effects; allow new levels where supported).}

\item{site_aug}{\code{NULL} or \code{data.frame}. Optional site-level augmentation table
(must contain \code{site_col}) to be left-joined into \code{site_env} before prediction.}

\item{species_aug}{\code{NULL} or \code{data.frame}. Optional species-level augmentation table
(must contain \code{species_col}) to be left-joined into \code{species_traits}.}
}
\value{
A list with:
\itemize{
\item \code{newdata}: the site × species table used in \code{predict()}.
\item \code{predictions}: long table with columns \code{site_col}, \code{species_col}, and \code{pred}.
\item \code{prediction_matrix}: wide matrix (sites × species) of predicted values
(rows ordered by site ID, columns by species ID).
}
}
\description{
Builds a complete \strong{site × species} prediction grid by crossing a species-trait table
(residents + simulated invaders) with a site-environment table, then calls the fitted
model’s \code{predict()} to obtain expected responses (e.g., abundance). The function is
robust to factor level issues and mirrors a typical \code{expand_grid()} + left-join workflow.
}
\details{
\strong{Model classes supported}
\itemize{
\item \strong{glmmTMB}: uses \code{type} and \code{re.form}. Population-level predictions set
\code{re.form = ~ 0} (default, \code{include_random = FALSE}); conditional predictions
use \code{re.form = NULL} with \code{allow.new.levels = TRUE}.
\item \strong{lme4::merMod} (\code{lmer}/\code{glmer}): population-level uses \code{re.form = NA};
conditional uses \code{re.form = NULL} with \code{allow.new.levels = TRUE}.
\item \strong{mgcv::gam}: passes \code{type} through (e.g., \code{"response"}).
\item \strong{stats::glm} / \strong{stats::lm}: standard \code{predict()}; \code{type} for GLM, none for LM.
}

\strong{Why population-level predictions by default?} For novel invaders, random-effect
levels (e.g., species/site intercepts) are unknown. Excluding random effects yields
fixed-effects expectations driven by traits, environments, and their interactions —
appropriate for invasion screening and ranking.

\strong{Augmentation inputs.} \code{site_aug} and/or \code{species_aug} let you add extra predictors
(e.g., \code{obs_sum}, \code{spp_rich}) prior to prediction, replicating the common
\code{left_join()} pattern used in analysis notebooks.
}
\examples{
\dontrun{
# Residents + invaders (traits), sites (env), fitted Tweedie glmmTMB model:
all_traits <- rbind(spp_trait, inv_traits)
out <- predict_invader_response(
  model          = mod,
  species_traits = all_traits,
  site_env       = site_env,
  species_col    = "species",
  site_col       = "site_id",
  response_type  = "response",
  include_random = FALSE, # population-level
  site_aug       = dplyr::select(spp_rich_obs, site_id, obs_sum, spp_rich)
)
head(out$predictions)
dim(out$prediction_matrix)
}

}
\seealso{
\code{\link[glmmTMB]{predict.glmmTMB}}, \code{\link[lme4]{predict.merMod}},
\code{\link[mgcv]{predict.gam}}, \code{\link[stats]{predict}}
}
